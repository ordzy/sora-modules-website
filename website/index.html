<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sora Modules</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Homepage View -->
        <div id="homepage">
            <h1>Sora Modules</h1>
            <p>Select a module:</p> 
            <div class="modules-grid" id="websiteGrid">
                <!-- Websites will be loaded here dynamically -->
            </div>
        </div>

        <!-- Redirect View -->
        <div id="redirectContent" class="redirect-container">
            <div class="loading"></div>
            <p>Opening in Sora...</p>
            <div class="link-display" id="linkDisplay"></div>
            <button class="button" onclick="copyLink()">Copy Link</button>
            <button onclick="showHomepage()" class="button">Back to Home</button>
            <p class="success-message" id="successMessage">Link copied successfully!</p>
        </div>
    </div>

    <!-- GitHub Link -->
    <a href="https://github.com/ordzy/sora-modules-website" class="github-link" target="_blank" rel="noopener noreferrer" aria-label="GitHub Repository">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/>
        </svg>
    </a>

    <script>
        // Website configurations
        const websites = {
            'jormungandr': {
                name: 'Jormungandr (Anime)',
                baseUrl: 'https://jormungandr.ofchaos.com/releases/sora/live/Jorm.json',
                redirectUrl: 'sora://module?url=https://jormungandr.ofchaos.com/releases/sora/live/Jorm.json',
                description: 'Language: English/Japanese<br>Dub/Sub'
            },
            'ashi': {
                name: 'Ashi (Movies/TV/Anime)',
                baseUrl: 'https://git.luna-app.eu/50n50/sources/raw/branch/main/ashi/ashi.json',
                redirectUrl: 'sora://module?url=https://git.luna-app.eu/50n50/sources/raw/branch/main/ashi/ashi.json',
                description: 'Language: English/Japanese<br>Dub/Sub'
            },
},
            'onepace': {
                name: 'One Pace (Anime)',
                baseUrl: 'https://git.luna-app.eu/ibro/services/raw/branch/main/onepace/onepace.json',
                redirectUrl: 'sora://module?url=https://git.luna-app.eu/ibro/services/raw/branch/main/onepace/onepace.json',
                description: 'Language: English/Japanese<br>Dub/Sub'
            },
//            'name': {
//                name: '',
//                baseUrl: '',
//                redirectUrl: 'sora://module?url=',
//                description: 'Language: <br>'
//            },

            // Add more websites here
        };

        // Function to create website cards
        function createWebsiteCards() {
            const grid = document.getElementById('websiteGrid');
            
            for (const [id, website] of Object.entries(websites)) {
                const card = document.createElement('div');
                card.className = 'module-card';
                card.onclick = () => handleRedirect(website.redirectUrl, website.baseUrl);
                
                card.innerHTML = `
                    <h3 class="module-title">${website.name}</h3>
                    <p class="module-description">${website.description}</p>
                `;
                
                grid.appendChild(card);
            }
        }

        // Function to handle redirect
        function handleRedirect(redirectUrl, baseUrl) {
            // Update the URL without reloading the page
            const websiteId = Object.entries(websites).find(([_, site]) => site.baseUrl === baseUrl)?.[0];
            if (websiteId) {
                window.history.pushState({ module: true }, '', `/${websiteId}`);
            }

            showRedirectView();
            
            // Set the link display
            const linkDisplay = document.getElementById('linkDisplay');
            linkDisplay.textContent = baseUrl;
            
            // Attempt to open the app
            window.location.href = redirectUrl;
            
            // Show the link display after a short delay (in case redirect fails)
            setTimeout(() => {
                linkDisplay.style.display = 'block';
            }, 1500);
        }

        // Function to show redirect view
        function showRedirectView() {
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('redirectContent').style.display = 'block';
        }

        // Function to show homepage
        function showHomepage() {
            document.getElementById('homepage').style.display = 'block';
            document.getElementById('redirectContent').style.display = 'none';
            window.history.pushState({ module: false }, '', '/');
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', (event) => {
            if (event.state?.module) {
                showRedirectView();
            } else {
                showHomepage();
            }
        });

        // Function to copy link
        function copyLink() {
            const linkText = document.getElementById('linkDisplay').textContent;
            navigator.clipboard.writeText(linkText).then(() => {
                const successMessage = document.getElementById('successMessage');
                successMessage.style.display = 'block';
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 2000);
            });
        }

        // Check if we're on a module path
        const path = window.location.pathname;
        const websiteId = path.slice(1); // Remove leading slash
        if (websiteId && websites[websiteId]) {
            handleRedirect(websites[websiteId].redirectUrl, websites[websiteId].baseUrl);
        }

        // Initialize website cards when the page loads
        document.addEventListener('DOMContentLoaded', createWebsiteCards);
    </script>
</body>
</html> 
